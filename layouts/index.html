{{ define "main" }}

<!-- HERO -->
<section class="hero">
    <div class="hero-avatar">
        <img src="{{ "images/avatar.jpg" | relURL }}" alt="Avion a Pedales" onerror="this.style.display='none'">
    </div>
    <h1>Avion a Pedales</h1>
    <p class="hero-bio">{{ .Site.Params.bio }}</p>
    <p class="hero-desc">{{ .Site.Params.description }}</p>
</section>

<!-- BENTO GRID -->
<section class="bento">

    <!-- Status update -->
    <div class="bento-card bento-status">
        <div class="card-label">Status — {{ .Site.Params.statusDate }}</div>
        <p>{{ .Site.Params.statusText }}</p>
    </div>



    <!-- Video verticale (desktop: col droite, span 3 rows) -->
    <div class="bento-card bento-video">
        <div class="card-label">{{ .Site.Params.links.video.title }}</div>
        <div class="video-container" id="video-container">
            {{ if .Site.Params.videoFile }}
            <video controls playsinline preload="metadata" poster="{{ .Site.Params.videoPoster | relURL }}">
                <source src="{{ .Site.Params.videoFile | relURL }}" type="video/mp4">
            </video>
            {{ else if .Site.Params.videoEmbed }}
            {{/* Extract video ID for thumbnail */}}
            {{ $embedUrl := .Site.Params.videoEmbed }}
            {{ $videoId := replaceRE `.*embed/([^?]+).*` "$1" $embedUrl }}
            <div class="video-poster-overlay" onclick="this.parentElement.innerHTML='<iframe src=\'{{ $embedUrl }}&autoplay=1\' allow=\'autoplay; encrypted-media\' allowfullscreen style=\'width:100%;height:100%;position:absolute;top:0;left:0;border:none;\'></iframe>'">
                <img src="https://img.youtube.com/vi/{{ $videoId }}/0.jpg" alt="{{ .Site.Params.links.video.title }}" loading="lazy">
                <div class="play-btn"></div>
            </div>
            {{ else }}
            <div class="video-placeholder">
                <span class="video-placeholder-icon">&#9654;</span>
                <span>Vidéo à venir</span>
            </div>
            {{ end }}
        </div>
    </div>

    <!-- Modele 3D avec image -->
    <a href="{{ .Site.Params.links.model.url }}" class="bento-card bento-model">
        <picture>
            <source media="(min-width: 601px)" srcset="{{ "images/model-3d-wide.png" | relURL }}">
            <img src="{{ "images/model-3d-square.png" | relURL }}" alt="{{ .Site.Params.links.model.title }}" loading="lazy">
        </picture>
        <div class="model-overlay">
            <span>{{ .Site.Params.links.model.title }}</span>
            <span class="arrow">&rarr;</span>
        </div>
    </a>

    <!-- Instagram -->
    <a href="{{ .Site.Params.instagram }}" class="bento-card bento-link" target="_blank">
        <span class="link-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg></span>
        <span>@avionapedales</span>
        <span class="arrow">&rarr;</span>
    </a>

    <a href="{{ .Site.Params.links.job.url }}" class="bento-card bento-link bento-highlight">
        <span class="link-icon">&#9881;</span>
        <span>{{ .Site.Params.links.job.title }}</span>
        <span class="arrow">&rarr;</span>
    </a>

    <!-- Patreon -->
    <a href="{{ .Site.Params.links.patreon.url }}" class="bento-card bento-link" target="_blank">
        <span class="link-icon">&#9829;</span>
        <span>{{ .Site.Params.links.patreon.title }}</span>
        <span class="arrow">&rarr;</span>
    </a>

    <!-- Latest blog posts -->
    <div class="bento-card bento-blog">
        <div class="card-label">Derniers articles</div>
        {{ range first 3 (where .Site.RegularPages "Section" "blog") }}
        <a href="{{ .RelPermalink }}" class="bento-blog-item">
            {{ $ytMatch := findRE `youtube\s+[a-zA-Z0-9_-]+` .RawContent 1 }}
            {{ $imgMatch := findRE `!\[.*?\]\([^)]+\)` .RawContent 1 }}
            {{ if $ytMatch }}
                {{ $videoID := replaceRE `^youtube\s+` "" (index $ytMatch 0) }}
                <img class="blog-item-thumb" src="https://img.youtube.com/vi/{{ $videoID }}/mqdefault.jpg" alt="" loading="lazy">
            {{ else if $imgMatch }}
                {{ $raw := index $imgMatch 0 }}
                {{ $imgURL := replaceRE `^!\[.*?\]\(` "" $raw }}
                {{ $imgURL = replaceRE `\)$` "" $imgURL }}
                <img class="blog-item-thumb" src="{{ $imgURL }}" alt="" loading="lazy">
            {{ end }}
            <span class="blog-item-date">{{ .Date.Format "Jan 2006" }}</span>
            <span class="blog-item-title">{{ .Title }}</span>
        </a>
        {{ end }}
        <a href="{{ "blog/" | absURL }}" class="bento-blog-more">Tous les articles &rarr;</a>
    </div>

</section>

{{ end }}
